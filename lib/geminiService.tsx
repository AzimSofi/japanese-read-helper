import { GoogleGenAI } from "@google/genai";

export const ai_instructions = 
`
  # 指示
あなたは、画像からテキスト情報を整理・抽出する専門家です。
私がアップロードする画像の内容を、以下のルールに従ってテキスト化してください。

## 絶対的なルール
1.  **出力はテキストのみ:**
    *   「以下は〜です」のような前置きや、「テキスト抽出」のような見出しは一切不要です。
    *   画像から抽出したテキスト**だけ**を出力してください。
    *   文字は一字一句、正確に書き出してください。

2.  **レイアウトに応じた対応:**
    *   **A) シンプルなレイアウトの場合:**
        *   書籍のページのように、テキストがひとまとまりになっている場合は、見たままの順番でテキストを書き出してください。
    *   **B) 複雑なレイアウトの場合:**
        *   テキストが複数のコラム、吹き出し、図のキャプションなどでバラバラに配置されている場合は、**「読みやすさ」を最優先**して、以下の工夫をしてください。
        *   **論理的な順序への再構成:** 人間が自然に読むであろう順番（例: メインタイトル → 本文 → 関連コラム）に並べ替えてください。
        *   **構造の可視化:** 見出しには'##'、箇条書きには'-'のように、マークダウン記法を使って情報の構造が分かるようにしてください。
        *   **ブロックの区切り:** 明らかに内容が異なるテキストブロック間には、区切り線として'---'を挿入してください。

# 開始
以上のルールに従い、これから私がアップロードする画像を処理してください。

`

export async function generateGeminiContent(prompt_post: string, ai_model: string): Promise<string> {
    const ai = new GoogleGenAI({apiKey: process.env.GEMINI_API_KEY});

    const response = await ai.models.generateContent({
        model: ai_model,
        contents: prompt_post,
      });
      
    return response.text || "";
}
